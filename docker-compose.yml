services:
  php-docs-converter-viewer:
    image: php:8.2-apache
    volumes:
      - ./php-docs-converter-viewer/src/:/var/www/html/
      - ./php-docs-converter-viewer/php.ini:/usr/local/etc/php/php.ini
      - ./php-docs-converter-viewer/apache2.conf:/etc/apache2/apache2.conf
    ports:
      - "20055:80"
    environment:
      - DEBIAN_FRONTEND=noninteractive
    command: > 
      bash -c "apt-get update -qq
      && apt-get install -y --no-install-recommends libfreetype6-dev libjpeg62-turbo-dev libpng-dev libwebp-dev libxpm-dev libzip-dev libreoffice fonts-nanum
      && docker-php-ext-configure gd --with-freetype --with-jpeg --with-webp --with-xpm
      && docker-php-ext-install -j$(nproc) gd zip
      && curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer
      && cd /var/www/html && composer install --no-dev --optimize-autoloader
      && a2enmod rewrite 
      && rm -rf /var/lib/apt/lists/*
      && apache2ctl -DFOREGROUND"